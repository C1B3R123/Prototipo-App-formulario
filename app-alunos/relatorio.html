<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Relatório de Alunos</title>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="messageBox" class="message-box"></div>

    <div class="container report-main-container">
      <h2>Relatório de Alunos</h2>

      <div id="studentReport" class="report-container">
        <p id="noStudentsMessage">Nenhum aluno cadastrado ainda.</p>
      </div>

      <p class="back-link"><a href="index.html">Voltar ao Menu Principal</a></p>
    </div>

    <script>
      // URL da API PHP no backend.
      const API_URL = "http://localhost/app-alunos/api.php";

      // Referências aos elementos HTML.
      const studentReport = document.getElementById("studentReport");
      const noStudentsMessage = document.getElementById("noStudentsMessage");
      const messageBox = document.getElementById("messageBox");

      /**
       * Exibe uma mensagem de feedback na tela.
       * @param {string} message - O texto da mensagem.
       * @param {string} [type='success'] - O tipo da mensagem.
       */
      function showMessage(message, type = "success") {
        messageBox.textContent = message;
        messageBox.className = "message-box show";
        messageBox.style.backgroundColor =
          type === "error" ? "#f44336" : "#4CAF50";
        setTimeout(() => {
          messageBox.classList.remove("show");
        }, 3000);
      }

      /**
       * Função assíncrona para buscar alunos da API e renderizar a tabela.
       */
      async function renderReport() {
        // Limpa o conteúdo anterior e exibe uma mensagem de carregamento.
        studentReport.innerHTML = "";
        noStudentsMessage.style.display = "block";
        noStudentsMessage.textContent = "Carregando alunos...";

        try {
          // Faz a requisição GET para a API para obter a lista de alunos.
          const response = await fetch(API_URL);

          // Lança um erro se a resposta da rede não for bem-sucedida.
          if (!response.ok) {
            throw new Error("Erro ao buscar alunos do servidor.");
          }

          // Converte a resposta JSON em um array de objetos JavaScript.
          const students = await response.json();

          // Verifica se não há alunos cadastrados.
          if (students.length === 0) {
            noStudentsMessage.textContent = "Nenhum aluno cadastrado ainda.";
            studentReport.appendChild(noStudentsMessage);
            // O CSS (.report-container) se encarrega de centralizar esta mensagem.
            return;
          } else {
            // Esconde a mensagem de "nenhum aluno" se houver dados.
            noStudentsMessage.style.display = "none";
          }

          // Cria dinamicamente a estrutura da tabela HTML (<table>, <thead>, <tbody>).
          const table = document.createElement("table");
          table.classList.add("table-styles");

          // Cria o cabeçalho da tabela.
          const thead = document.createElement("thead");
          thead.innerHTML = `
                    <tr>
                        <th>Nome</th>
                        <th>R.A.</th>
                        <th>E-mail</th>
                        <th>Curso</th>
                    </tr>
                `;
          table.appendChild(thead);

          // Preenche o corpo da tabela com os dados dos alunos.
          const tbody = document.createElement("tbody");
          students.forEach((student) => {
            const row = document.createElement("tr");
            // As propriedades (student.name, student.student_id, etc.) devem corresponder aos aliases da API PHP.
            row.innerHTML = `
                        <td>${student.name}</td>
                        <td>${student.student_id}</td>
                        <td>${student.email}</td>
                        <td>${student.course}</td>
                    `;
            tbody.appendChild(row);
          });

          table.appendChild(tbody);
          // Adiciona a tabela completa ao contêiner de relatório na página.
          studentReport.appendChild(table);
        } catch (error) {
          // Captura e exibe erros durante o carregamento dos alunos.
          console.error("Erro ao carregar alunos:", error);
          showMessage("Erro ao carregar alunos. Tente novamente.", "error");
          noStudentsMessage.textContent = "Erro ao carregar alunos.";
        }
      }

      // Executa a função 'renderReport' assim que a página estiver completamente carregada.
      document.addEventListener("DOMContentLoaded", renderReport);
    </script>
  </body>
</html>
